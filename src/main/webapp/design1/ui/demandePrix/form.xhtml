<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:seosoft="http://java.sun.com/jsf/composite/components"
                template="/design1/_general/template.xhtml">

    <ui:define name="head">        
        <script type="text/javascript">
            //<![CDATA[
                function handleMessage(facesmessage) {
                    facesmessage.severity = 'info';
                    
                    PF('growl').show([facesmessage]);
                }
            //]]> 
        </script>
    </ui:define>
    
    <ui:define name="title">
        Article
    </ui:define>

    <ui:define name="description">
        Création d'un nouvel article
    </ui:define>
	
    <ui:define name="implementation">
    
	  <div style="padding:30px">
        		
        	<p:panelGrid styleClass="no-border-table full-width panelTopAlign">
        		<p:row>
        			<p:column>
						<h:panelGroup>
							<h:panelGrid columns="2" cellpadding="5"  styleClass="no-border-table full-width" >
								<p:outputLabel value="Date:" />
<!-- 		       					<p:inputText value="#{core.bean().object.date}" pattern="dd-MM-yyyy" mask="true" /> -->
		       					<p:calendar value="#{core.bean().object.date}" pattern="dd/MM/yyyy" mask="true"/>
		       					
		       					<h:outputLabel value="Fournisseur :" />
		       					
		       					<p:selectOneMenu id="fournisseur" widgetVar="fournisseurVar" value="#{core.bean().object.fournisseur}" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="startsWith"
		    									 style="width:160px" required="true">      	    
						        	<f:selectItem itemLabel="" itemValue="" />
						        	<f:selectItems value="#{core.bean('fournisseur').list}" var="entity" itemLabel="#{entity.getDisplayText()}" itemValue="#{entity}" />
		 				        	<p:ajax event="change" update="#{core.bean().getComponentById('adresseCommande').getClientId()}" listener="#{core.bean().runAction('updateAdresseCommande')}"/>
						        </p:selectOneMenu>
		       					
		       					
		       					<h:outputLabel value="Origine :" />
								<p:inputText value="#{core.bean().object.origine}" size="50"/>
								
								<h:outputLabel value="Origine :" />
								<p:inputText value="#{core.bean().object.origine}" size="50"/>
								
								<h:outputLabel value="Texte libre :" />
								<p:inputTextarea rows="6" cols="40"  value="#{core.bean().object.texteLibre}"/>
								
								<h:outputLabel value="Observations :" />
								<p:inputTextarea rows="6" cols="40"  value="#{core.bean().object.observations}"/>
								
		
						    </h:panelGrid>
						</h:panelGroup>
					</p:column>
					<p:column style="width:50%">	
						<h:panelGroup>
							<p:tabView >
				       			<p:tab title="Valeurs">
				       			
				       		   	</p:tab>
				       		   	<p:tab title="Coordonnées">
				       				<p:tabView>
							       		<p:tab title="Adresse livraison">
							       			<h:panelGrid id="adresseLivraison" columns="2" cellpadding="5">
						       				   <h:outputLabel value=" Adresse : *" />
									           <p:inputText id="adresseLivraisonLigne1" value="#{core.bean().object.adresseLivraisonLigne1}" size="50"/>
									           <h:outputLabel value="" />
									           <p:inputText id="adresseLivraisonigne2" value="#{core.bean().object.adresseLivraisonLigne2}" size="50"/>
								           	   <h:outputLabel value="Code postal : *" />
									           <p:inputText id="adresseLivraisonCodePostal" value="#{core.bean().object.adresseLivraisonCodePostal}" size="50"/>
								           	   <h:outputLabel value="" />
								           	   <h:panelGrid columns="2">
									           	   <p:selectOneMenu id="adresseLivraisonPays" widgetVar="adresseLivraisonPaysVar" value="#{core.bean().object.adresseLivraisonPays}" filter="true" filterMatchMode="startsWith"
						    										style="width:134px" required="true">      	    
											        	<f:selectItem itemLabel="Maroc" itemValue="MA" />
											        	<f:selectItem itemLabel="France" itemValue="FR" />
											        	<f:selectItem itemLabel="Etats Unis d'amérique" itemValue="USA" />
											       </p:selectOneMenu>
											       <p:selectOneMenu id="adresseLivraisonVille" widgetVar="adresseLivraisonVilleVar" value="#{core.bean().object.adresseLivraisonVille}" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="startsWith"
						    										style="width:134px" required="true">      	    
											        	<f:selectItem itemLabel="Rabat" itemValue="rabat" />
											        	<f:selectItem itemLabel="Paris" itemValue="paris" />
											        	<f:selectItem itemLabel="New York" itemValue="new york" />
											       </p:selectOneMenu>
								           	   </h:panelGrid>
							       			</h:panelGrid>
							       		</p:tab>
							       		<p:tab title="Adresse commande">
							       		    <h:panelGrid id="adresseCommande" columns="2" cellpadding="5">
						       				   <h:outputLabel value=" Adresse : *" />
									           <p:inputText id="adresseCommandeLigne1" value="#{core.bean().object.adresseCommandeLigne1}" size="50"/>
									           <h:outputLabel value="" />
									           <p:inputText id="adresseCommandeigne2" value="#{core.bean().object.adresseCommandeLigne2}" size="50"/>
								           	   <h:outputLabel value="Code postal : *" />
									           <p:inputText id="adresseCommandeCodePostal" value="#{core.bean().object.adresseCommandeCodePostal}" size="50"/>
								           	   <h:outputLabel value="" />
								           	   <h:panelGrid columns="2">
									           	   <p:selectOneMenu id="adresseCommandePays" widgetVar="adresseCommandePaysVar" value="#{core.bean().object.adresseCommandePays}" filter="true" filterMatchMode="startsWith"
						    										style="width:134px">      	    
											        	<f:selectItem itemLabel="Maroc" itemValue="MA" />
											        	<f:selectItem itemLabel="France" itemValue="FR" />
											        	<f:selectItem itemLabel="Etats Unis d'amérique" itemValue="USA" />
											       </p:selectOneMenu>
											       <p:selectOneMenu id="adresseCommandeVille" widgetVar="adresseCommandeVilleVar" value="#{core.bean().object.adresseCommandeVille}" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="startsWith"
						    										style="width:134px">      	    
											        	<f:selectItem itemLabel="Rabat" itemValue="rabat" />
											        	<f:selectItem itemLabel="Paris" itemValue="paris" />
											        	<f:selectItem itemLabel="New York" itemValue="new york" />
											       </p:selectOneMenu>
								           	   </h:panelGrid>
							       			</h:panelGrid>
							       		</p:tab>
					       			</p:tabView>
				       		   	</p:tab>
				       		   	<p:tab title="Divers">
				       		   		<p:panel>
					       		   		<h:panelGrid columns="2" cellpadding="5">
					       		   			<h:outputLabel value="Dépôt par défaut" />
					       		   			
					       		   			<p:selectOneMenu id="depot" widgetVar="depotVar" value="#{core.bean().object.depot}" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="startsWith"
		    									 style="width:160px" required="true">      	    
									        	<f:selectItem itemLabel="" itemValue="" />
									        	<f:selectItems value="#{core.bean('depot').list}" var="entity" itemLabel="#{entity.getDisplayText()}" itemValue="#{entity}" />
					 				        	<p:ajax event="change" update="#{core.bean().getComponentById('adresseLivraison').getClientId()}" listener="#{core.bean().runAction('updateAdresseLivraison')}"/>
									        </p:selectOneMenu>
					       		   			
					       		   			<h:outputLabel value="Expédition " />
					       		   			<seosoft:OneEntitySelectMenu id="modeExpedition" entityName="modeExpedition" value="#{core.bean().object.modeExpedition}"></seosoft:OneEntitySelectMenu>
					       		   			
					       		   			<h:outputLabel value="Transport " />
					       		   			<seosoft:OneEntitySelectMenu id="modeTransport" entityName="modeTransport" value="#{core.bean().object.modeTransport}"></seosoft:OneEntitySelectMenu>
					       		   			
					       		   			<h:outputLabel value="Livraison prévue le " />
<!-- 					       		   			<p:inputText value="#{core.bean().object.dateLivraisonPrevue}" pattern="dd-MM-yyyy" mask="true" /> -->
					       		   			<p:calendar value="#{core.bean().object.dateLivraisonPrevue}" pattern="dd/MM/yyyy" mask="true" />
					       		   		</h:panelGrid>
				       		   		</p:panel>
				       		   		
				       		   		<p:panel>
					       		   		<h:panelGrid columns="2" cellpadding="5">
					       		   			<h:outputLabel value="Mode de réglement" />
					       		   			<seosoft:OneEntitySelectMenu id="modeReglement" entityName="modeReglement" value="#{core.bean().object.modeReglement}"></seosoft:OneEntitySelectMenu>
					       		   			
					       		   		</h:panelGrid>
				       		   		</p:panel>
				       		   	</p:tab>
				       		</p:tabView>
			       		</h:panelGroup>
			       	</p:column>
	       		</p:row>
	       		<p:row>
	       			<p:column colspan="2">
		       			<p:dataTable id="detailsDatatable" var="ligneDetails" value="#{core.bean().detailsDemandePrixList}" editable="true" editMode="cell" widgetVar="detailsVar">
					 
						   <p:ajax event="cellEdit" listener="#{core.bean().onDetailsDatatableCellEdit}" update=":mainForm:messages" />
					 
					       <p:column headerText="Article">
					           <p:cellEditor>
					               <f:facet name="output">
					               	<h:outputText value="#{ligneDetails.article.getDisplayText()}" />
<!-- 					               	    <h:selectOneMenu value="#{ligneDetails.article}" style="width:90%; opacity:0.6" converter="omnifaces.SelectItemsConverter"> -->
<!-- 						        		  	<f:selectItem itemLabel="" itemValue="" />  -->
<!-- 						        		  	<f:selectItems value="#{core.bean('article').list}" var="entity" itemLabel="#{entity.getDisplayText()}" itemValue="#{entity}" /> -->
<!-- 					                    </h:selectOneMenu> -->
					               </f:facet>
					               <f:facet name="input">
					                   <h:selectOneMenu value="#{ligneDetails.article}" style="width:90%" converter="omnifaces.SelectItemsConverter">
<!-- 						        		    <f:selectItem itemLabel="" itemValue="" /> -->
						        		    <f:selectItems value="#{core.bean('article').list}" var="entity" itemLabel="#{entity.getDisplayText()}" itemValue="#{entity}" />
						        		    <p:ajax event="change" update="detailsDatatable"/>
					                   </h:selectOneMenu>
					               </f:facet>
					           </p:cellEditor>
					       </p:column>
					       
					       <p:column headerText="Qte">
					           <p:cellEditor>
					               <f:facet name="output"><p:inputText value="#{ligneDetails.qte}" style="width:95%;opacity:0.6" /></f:facet>
					               <f:facet name="input"><p:inputText value="#{ligneDetails.qte}" style="width:95%"/></f:facet>
					           </p:cellEditor>
				       	   </p:column>
				       	   
				       	   <p:column headerText="P.U.A.">
					           <p:cellEditor>
					               <f:facet name="output">
					               		<p:inputText value="#{ligneDetails.article.prixUnitaireAchat}" style="width:95%;opacity:0.6"  >
					               			<f:convertNumber pattern="#0.00" />
					               		</p:inputText>
					               	</f:facet>
					               <f:facet name="input"><p:inputText value="#{ligneDetails.article.prixUnitaireAchat}" style="width:95%"/></f:facet>
					           </p:cellEditor>
				       	   </p:column>
				       	   
				       	   
				       	   <p:column headerText="Mt. HT">
					           <p:cellEditor>
					               <f:facet name="output"><p:inputText value="#{ligneDetails.qte * ligneDetails.prixHt}" style="width:95%;opacity:0.6" /></f:facet>
					               <f:facet name="input"><p:inputText value="#{ligneDetails.qte * igneDetails.prixHt}" style="width:95%"/></f:facet>
					           </p:cellEditor>
				       	   </p:column>
				       	   
				       	   <p:column headerText="" style="width:32px">
				       	   	  <f:facet name="header">
						         <h:outputText value="" />
						      </f:facet>
					          <p:commandButton rendered="#{core.bean().detailsDemandePrixList.size() - 1 eq core.bean().detailsDemandePrixList.indexOf(ligneDetails)}" actionListener="#{core.bean().addRowToDetailsDatatable}" update="detailsDatatable" process="detailsDatatable" icon="ui-icon-plus" ajax="true"/>
					          <p:commandButton rendered="#{core.bean().detailsDemandePrixList.size() - 1 ne core.bean().detailsDemandePrixList.indexOf(ligneDetails)}" actionListener="#{core.bean().removeRowToDetailsDatatable(core.bean().detailsDemandePrixList.indexOf(ligneDetails))}" update="detailsDatatable" process="@this" icon="ui-icon-closethick" ajax="true" styleClass="ui-whiteBtn"/>
				       	   </p:column>
					   </p:dataTable>
					</p:column>
	       		</p:row>
       		</p:panelGrid>
		       	
      </div>
    </ui:define>
    
	<ui:define name="actions">	
		<p:commandButton value="Enregistrer" actionListener="#{core.bean().runAction('persist')}" update="mainForm" process="mainForm" styleClass="ui-whiteBtn" />
		<p:button value="Retour" href="/design1/ui/#{core.bean().moduleName}/list" styleClass="ui-whiteBtn pull-right"/>
		<!-- <p:commandButton value="Vider" actionListener="#{notifyView.send}" styleClass="ui-whiteBtn pull-right" style="margin-right:10px;"/> -->
		<p:commandButton value="Supprimer" rendered="#{core.bean().paramId != null }" actionListener="#{core.bean().runAction('delete')}" update=":mainForm" styleClass="ui-whiteBtn" />
		<p:outputPanel rendered="#{core.bean().paramId != null }" style="display:inline;" styleClass="pull-right">			
			<span style="margin-right:10px;"><p:outputLabel value="#{core.bean().list.indexOf(core.bean().object) + 1}"/> / <p:outputLabel value="#{core.bean().list.size()}"/></span>
			<p:commandButton value="&lt;" actionListener="#{core.bean().runAction('getPrevious')}" update=":mainForm" process="@this" styleClass="ui-whiteBtn" style="margin-right:10px;"/>
			<p:commandButton value="&gt;" actionListener="#{core.bean().runAction('getNext')}" update=":mainForm" process="@this" styleClass="ui-whiteBtn" style="margin-right:10px;"/>
		</p:outputPanel>
	</ui:define>
	
	<ui:define name="dialogs">
		   
	</ui:define>
	
</ui:composition>
